---
title: "DATA334 Final Project - Data Science Salaries"
author: "Brody Pinto"
format: 
  html:
    embed-resources: true
warning: false
---

```{r}
library(tidyverse)

theme_set(theme_minimal())

salary <- read.csv("archive (1)/v7_Latest_Data_Science_Salaries.csv", stringsAsFactors = TRUE) |>
  mutate(Year = as_factor(Year))
```

## My goal for this final project is to create a shiny app that allows the user to visualize the data in as many different ways as possible!

To start, I'm going to want to include an option to do frequency plots and/or histograms for the salaries per `Job.Title`, per `Employment.Type`, per `Experience.Level`, per `Company.Location`, and per `Company.Size`. I will also include a reactive summary statistics table (mean, median, min, max, standard deviation, count).

I also want to allow the user to select any number of years (2020-2024) to be included.

If I have time, I may try to include a user option to try fitting logistic regression models (with up to 2 or 3 predictors) to the data.

```{r}
library(shiny)

job_vec <- unique(salary$Job.Title) |>
  fct_expand("All") |>
  levels()

location_vec <- unique(salary$Company.Location) |>
  fct_expand("All") |>
  levels()

type_vec <- unique(salary$Employment.Type) |>
  fct_expand("All") |>
  levels()

ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(selectInput(inputId = "job_sel", 
                             label = "Select a Job:",
                             choices = job_vec,
                             selected = "Data Scientist"),
                 checkboxGroupInput(inputId = "exp_sel",
                                    label = "Select an Experience Level:",
                                    choices = c("Entry", "Mid", "Senior", "Executive")),
                 selectInput(inputId = "location_sel",
                             label = "Select a Location:",
                             choices = location_vec,
                             selected = "United States"),
                 checkboxGroupInput(inputId = "size_sel",
                                    label = "Select a Company Size:",
                                    choices = c("Small", "Medium", "Large")),
                 checkboxGroupInput(inputId = "year_sel",
                                    label = "Select Any Year(s):",
                                    choices = c(2020:2024)),
                 selectInput(inputId = "type_sel",
                             label = "Select an Employment Type:",
                             choices = type_vec,
                             selected = "All"),
                 sliderInput(inputId = "bin_sel",
                             label = "Select a Number of Histogram Bins:",
                             min = 1,
                             max = 50,
                             value = 15)),
    mainPanel(plotOutput(outputId = "hist_plot"),
              tableOutput(outputId = "data_table"))
  )
)

server <- function(input, output, session) {
  
  ## observeEvent(): first argument is either an input or a reactive data frame
  ## when something in the first argument changes, the code in the { } is triggered to update
  observeEvent(input$tour_sel, {
    
    player_choices = df |> 
      filter(tour == input$tour_sel) |>
      distinct(player) |> 
      pull(player)
    
    updateSelectInput(inputId = "player_sel",
                      choices = player_choices)
  })
  
  job_react = reactive({
    
    if (input$job_sel == "All") {
      job_df = salary
    } else {
      job_df = salary |> filter(Job.Title == input$job_sel)
    }
    
    if (input$location_sel == "All") {
      job_df = job_df
    } else {
      job_df = job_df |> filter(Company.Location == input$location_sel)
    }
    
    if (input$type_sel == "All") {
      job_df = job_df
    } else {
      job_df = job_df |> filter(Employment.Type == input$type_sel)
    }
    
    job_df = job_df |> 
      filter(Experience.Level %in% input$exp_sel) |>
      filter(Company.Size %in% input$size_sel) |>
      filter(Year %in% input$year_sel)
    
  })
  
  output$hist_plot = renderPlot({
    ggplot(data = job_react(), aes(x = Salary.in.USD)) +
      geom_histogram(bins = input$bin_sel, col = "lightblue4", fill = "lightblue") +
      labs(title = glue::glue("Histogram of Salary (USD) for ", input$job_sel, " Jobs")) +
      theme_minimal(base_size = 25) +
      labs(x = "Salary (USD)")
  })
  
  output$data_table = renderTable({
    
    job_react() |> group_by(Job.Title) |>
      summarise(mean_salary = mean(Salary.in.USD),
                median_salary = median(Salary.in.USD),
                minimum_salary = min(Salary.in.USD),
                maximum_salary = max(Salary.in.USD),
                sd_salary = sd(Salary.in.USD),
                count = n())
    
  })
}
shinyApp(ui, server)
```

